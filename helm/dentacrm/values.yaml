# DentraCRM Helm Values
# Configure these values for your deployment

# Global settings
global:
  domain: dentacrm.in
  environment: production

# Namespace
namespace: dentacrm

# Docker image settings
image:
  registry: ""  # Your ECR registry URL, e.g., 123456789.dkr.ecr.ap-south-1.amazonaws.com
  pullPolicy: IfNotPresent
  # pullSecrets:
  #   - name: ecr-registry-secret

# API Backend
api:
  name: api
  replicaCount: 2
  image:
    repository: dentacrm-api
    tag: latest
  
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  
  service:
    type: ClusterIP
    port: 3000
  
  env:
    NODE_ENV: production
    PORT: "3000"
    JWT_EXPIRY: "24h"
  
  # Secrets - these should be stored in AWS Secrets Manager or K8s Secrets
  secrets:
    jwtSecret: ""  # Will be generated if empty
    platformDatabaseUrl: ""
  
  # Health checks
  livenessProbe:
    httpGet:
      path: /health
      port: 3000
    initialDelaySeconds: 30
    periodSeconds: 10
  
  readinessProbe:
    httpGet:
      path: /ready
      port: 3000
    initialDelaySeconds: 5
    periodSeconds: 5

  # Pod disruption budget
  pdb:
    enabled: true
    minAvailable: 1

  # Horizontal Pod Autoscaler
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

# Frontend
frontend:
  name: frontend
  replicaCount: 2
  image:
    repository: dentacrm-frontend
    tag: latest
  
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"
  
  service:
    type: ClusterIP
    port: 80

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    # Rate limiting
    nginx.ingress.kubernetes.io/limit-rps: "100"
    nginx.ingress.kubernetes.io/limit-connections: "50"
    # CORS
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "https://dentacrm.in"
    # cert-manager TLS
    cert-manager.io/cluster-issuer: letsencrypt-prod
    # external-dns
    external-dns.alpha.kubernetes.io/hostname: dentacrm.in
  
  hosts:
    - host: dentacrm.in
      paths:
        - path: /api
          pathType: Prefix
          backend: api
        - path: /
          pathType: Prefix
          backend: frontend
  
  tls:
    - secretName: dentacrm-tls
      hosts:
        - dentacrm.in
        - "*.dentacrm.in"

# PostgreSQL (Bitnami chart)
# Set enabled: false if using external DB like Neon
postgresql:
  enabled: false  # Using Neon PostgreSQL instead
  auth:
    postgresPassword: ""
    database: dentacrm
  primary:
    persistence:
      enabled: true
      size: 10Gi

# Tenant configuration
tenants:
  - id: avmsmiles
    name: "AVM Smiles"
    plan: starter
    databaseUrl: ""  # Set via secrets

# Service Account for AWS IAM Roles
serviceAccount:
  create: true
  name: dentacrm-sa
  annotations:
    eks.amazonaws.com/role-arn: ""  # IAM role ARN for IRSA

# Pod Security
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# Node selector and tolerations
nodeSelector: {}
tolerations: []
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - dentacrm-api
          topologyKey: kubernetes.io/hostname
